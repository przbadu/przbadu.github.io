<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Rails count vs size vs length" /><meta property="og:locale" content="en" /><meta name="description" content="There are lots of ways to impact performance of your application. Initially when there is less data, everythings looks good, and eventually, when your traffic and active number of users using your application grows, you will start seeing some serious performance problem in your application." /><meta property="og:description" content="There are lots of ways to impact performance of your application. Initially when there is less data, everythings looks good, and eventually, when your traffic and active number of users using your application grows, you will start seeing some serious performance problem in your application." /><link rel="canonical" href="https://przbadu.github.io/posts/rails-count-vs-size-vs-length/" /><meta property="og:url" content="https://przbadu.github.io/posts/rails-count-vs-size-vs-length/" /><meta property="og:site_name" content="Pushpa Raj Badu" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-19T10:24:00+05:45" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Rails count vs size vs length" /><meta name="twitter:site" content="@przbadu" /><meta name="google-site-verification" content="o4nEmV_E1euvacULBhaIa5OiaS1245T1K-Xp74nZvz0" /> <script type="application/ld+json"> {"description":"There are lots of ways to impact performance of your application. Initially when there is less data, everythings looks good, and eventually, when your traffic and active number of users using your application grows, you will start seeing some serious performance problem in your application.","headline":"Rails count vs size vs length","dateModified":"2022-01-19T10:24:00+05:45","datePublished":"2022-01-19T10:24:00+05:45","url":"https://przbadu.github.io/posts/rails-count-vs-size-vs-length/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://przbadu.github.io/posts/rails-count-vs-size-vs-length/"},"@context":"https://schema.org"}</script><title>Rails count vs size vs length | Pushpa Raj Badu</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Pushpa Raj Badu"><meta name="application-name" content="Pushpa Raj Badu"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Pushpa Raj Badu</a></div><div class="site-subtitle font-italic">Full-Stack Developer, I will help you turn your business idea into reality.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://www.linkedin.com/in/przbadu" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/przbadu" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/przbadu" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pushparaj.badu','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Rails count vs size vs length</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Rails count vs size vs length</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/przbadu">Pushpa Raj Badu</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-01-19 10:24:00 +0545" data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 19, 2022, 10:24 AM +0545" >Jan 19</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="806 words"> <em>4 min</em> read</span></div></div></div><div class="post-content"><p>There are lots of ways to impact performance of your application. Initially when there is less data, everythings looks good, and eventually, when your traffic and active number of users using your application grows, you will start seeing some serious performance problem in your application.</p><p>And in this post we are going to look at why we need to understand difference between <code class="language-plaintext highlighter-rouge">.count</code>, <code class="language-plaintext highlighter-rouge">length</code> and <code class="language-plaintext highlighter-rouge">.size</code> methods to avoid performance problem.</p><p>Befor starting the comparision, lets make sure we have a basic rails application to work with</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>rails new demo
rails g model Post title
rails g model Comment body:text post:belongs_to
</pre></table></code></div></div><p>Open your <code class="language-plaintext highlighter-rouge">Post</code> model and add:</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1"># models/post.rb</span>
<span class="n">has_many</span> <span class="ss">:comments</span>
</pre></table></code></div></div><p>Now lets create some records in our database by using <code class="language-plaintext highlighter-rouge">seeds.rb</code> file</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1"># db/seeds.rb</span>

<span class="mi">2</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"post </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="mi">2</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span>
    <span class="n">post</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">body: </span><span class="s2">"Comment: </span><span class="si">#{</span><span class="n">j</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rails db:seed
</pre></table></code></div></div><h2 id="count">Count<a href="#count" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>If you want to know how many entries are there in <code class="language-plaintext highlighter-rouge">Post</code> model, than use <code class="language-plaintext highlighter-rouge">count</code>, which will perform <code class="language-plaintext highlighter-rouge">select count(*) ...</code> query and return <code class="language-plaintext highlighter-rouge">integer</code> value as result.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="no">Post</span><span class="p">.</span><span class="nf">count</span>
  <span class="no">Post</span> <span class="no">Count</span> <span class="p">(</span><span class="mf">0.5</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="no">FROM</span> <span class="s2">"posts"</span>
<span class="o">=&gt;</span> <span class="mi">2</span>
</pre></table></code></div></div><p>But if you already have list of ActiveRecord objects stored in a variable, then using <code class="language-plaintext highlighter-rouge">count</code> is not a good idea, because it will still fires additional ActiveRecord query, because <a href="https://apidock.com/rails/ActiveRecord/Calculations/ClassMethods/count">count</a> is a ActiveRecord method.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">posts</span> <span class="o">=</span> <span class="no">Posts</span><span class="p">.</span><span class="nf">all</span>
<span class="n">posts</span><span class="p">.</span><span class="nf">count</span>
  <span class="no">Post</span> <span class="no">Count</span> <span class="p">(</span><span class="mf">0.3</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="no">FROM</span> <span class="s2">"posts"</span>
<span class="o">=&gt;</span> <span class="mi">2</span>
</pre></table></code></div></div><p>And if we are dealing with associated child records inside loop/iteration then using <code class="language-plaintext highlighter-rouge">count</code> in active record association object can cause <code class="language-plaintext highlighter-rouge">N+1</code> query problem. So always avoid doing this.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1"># posts with eger loaded comments</span>
<span class="n">posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:comments</span><span class="p">).</span><span class="nf">first</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="no">Post</span> <span class="no">Load</span> <span class="p">(</span><span class="mf">0.1</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">"posts"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"posts"</span> <span class="no">ORDER</span> <span class="no">BY</span> <span class="s2">"posts"</span><span class="o">.</span><span class="s2">"id"</span> <span class="no">ASC</span> <span class="no">LIMIT</span> <span class="p">?</span>  <span class="p">[[</span><span class="s2">"LIMIT"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
   <span class="no">Comment</span> <span class="no">Load</span> <span class="p">(</span><span class="mf">0.2</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">"comments"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"comments"</span> <span class="no">WHERE</span> <span class="s2">"comments"</span><span class="o">.</span><span class="s2">"post_id"</span> <span class="no">IN</span> <span class="p">(</span><span class="sc">?,</span> <span class="p">?)</span>  <span class="p">[[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>

<span class="c1"># first iteration</span>
<span class="n">posts</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">p</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">count</span> <span class="p">}</span>
  <span class="no">Comment</span> <span class="no">Count</span> <span class="p">(</span><span class="mf">0.1</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="no">FROM</span> <span class="s2">"comments"</span> <span class="no">WHERE</span> <span class="s2">"comments"</span><span class="o">.</span><span class="s2">"post_id"</span> <span class="o">=</span> <span class="p">?</span>  <span class="p">[[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
  <span class="no">Comment</span> <span class="no">Count</span> <span class="p">(</span><span class="mf">0.1</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="no">FROM</span> <span class="s2">"comments"</span> <span class="no">WHERE</span> <span class="s2">"comments"</span><span class="o">.</span><span class="s2">"post_id"</span> <span class="o">=</span> <span class="p">?</span>  <span class="p">[[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

<span class="c1"># second iteration</span>
<span class="n">posts</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">p</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">count</span> <span class="p">}</span>
  <span class="no">Comment</span> <span class="no">Count</span> <span class="p">(</span><span class="mf">0.1</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="no">FROM</span> <span class="s2">"comments"</span> <span class="no">WHERE</span> <span class="s2">"comments"</span><span class="o">.</span><span class="s2">"post_id"</span> <span class="o">=</span> <span class="p">?</span>  <span class="p">[[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
  <span class="no">Comment</span> <span class="no">Count</span> <span class="p">(</span><span class="mf">0.1</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="no">FROM</span> <span class="s2">"comments"</span> <span class="no">WHERE</span> <span class="s2">"comments"</span><span class="o">.</span><span class="s2">"post_id"</span> <span class="o">=</span> <span class="p">?</span>  <span class="p">[[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></table></code></div></div><p>Here we can see, if we use <code class="language-plaintext highlighter-rouge">count</code> in <code class="language-plaintext highlighter-rouge">post.comments</code> association, than it will always fire a <code class="language-plaintext highlighter-rouge">select count(*) ...</code> SQL query for each post in an iteration. This will always give correct result but with the cost of <code class="language-plaintext highlighter-rouge">N+1</code> query problem. Which can impact performance of you app vastly, depending on how many records you are iterating through.</p><h2 id="length">length<a href="#length" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>On the other hand, you can’t use <code class="language-plaintext highlighter-rouge">length</code> on ActiveRecord Model directly</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="no">Post</span><span class="p">.</span><span class="nf">length</span>
<span class="o">&gt;</span> <span class="n">undefined</span> <span class="nb">method</span> <span class="sb">`length' for Post:Class (NoMethodError)
</span></pre></table></code></div></div><p>but lets say you already have a variable which holds your list of post objects, then using <code class="language-plaintext highlighter-rouge">length</code> will avoid additional ActiveRecord query</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>
<span class="n">posts</span><span class="p">.</span><span class="nf">length</span>
<span class="o">=&gt;</span> <span class="mi">2</span>
</pre></table></code></div></div><p>as you can see, there is no additional ActiveRecord query called, because <a href="https://apidock.com/ruby/Array/length">length</a> is a ruby method.</p><p>Now lets check our above active record association example and use <code class="language-plaintext highlighter-rouge">.length</code> instead of <code class="language-plaintext highlighter-rouge">.count</code></p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:comments</span><span class="p">).</span><span class="nf">first</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="no">Post</span> <span class="no">Load</span> <span class="p">(</span><span class="mf">0.1</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">"posts"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"posts"</span> <span class="no">ORDER</span> <span class="no">BY</span> <span class="s2">"posts"</span><span class="o">.</span><span class="s2">"id"</span> <span class="no">ASC</span> <span class="no">LIMIT</span> <span class="p">?</span>  <span class="p">[[</span><span class="s2">"LIMIT"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
   <span class="no">Comment</span> <span class="no">Load</span> <span class="p">(</span><span class="mf">0.2</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">"comments"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"comments"</span> <span class="no">WHERE</span> <span class="s2">"comments"</span><span class="o">.</span><span class="s2">"post_id"</span> <span class="no">IN</span> <span class="p">(</span><span class="sc">?,</span> <span class="p">?)</span>  <span class="p">[[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>

<span class="c1"># first iteration</span>
<span class="n">posts</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">p</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">length</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></table></code></div></div><p>Because we are already eger loading <code class="language-plaintext highlighter-rouge">includes(:comments)</code>, there is no further AR query made. Another thing to note is, if you are not using eger loading, than for the first iteration, it will fire ActiveRecord query, and cache the result, and second attempt to call <code class="language-plaintext highlighter-rouge">.length</code> will return cached result.</p><h2 id="size">Size<a href="#size" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><a href="https://apidock.com/rails/ActiveRecord/Associations/AssociationCollection/size">size</a> is an ActiveRecord method which is equivalent to <code class="language-plaintext highlighter-rouge">length</code> if the collection has been already loaded. Size will pick <code class="language-plaintext highlighter-rouge">length</code> or <code class="language-plaintext highlighter-rouge">count</code> based on your ActiveRecord object. so if you don’t want to manage <code class="language-plaintext highlighter-rouge">length</code> or <code class="language-plaintext highlighter-rouge">count</code> then using <code class="language-plaintext highlighter-rouge">size</code> is more efficient.</p><p>That being said, you still can’t use <code class="language-plaintext highlighter-rouge">.size</code> on model class directly with <code class="language-plaintext highlighter-rouge">Post.size</code>, it will throw <code class="language-plaintext highlighter-rouge">NoMethodError</code>.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>
<span class="n">posts</span><span class="p">.</span><span class="nf">size</span>
<span class="o">=&gt;</span> <span class="mi">2</span>
</pre></table></code></div></div><p>No additional ActiveRecord query fired.</p><p>And with association:</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:comments</span><span class="p">).</span><span class="nf">first</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="no">Post</span> <span class="no">Load</span> <span class="p">(</span><span class="mf">0.1</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">"posts"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"posts"</span> <span class="no">ORDER</span> <span class="no">BY</span> <span class="s2">"posts"</span><span class="o">.</span><span class="s2">"id"</span> <span class="no">ASC</span> <span class="no">LIMIT</span> <span class="p">?</span>  <span class="p">[[</span><span class="s2">"LIMIT"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
   <span class="no">Comment</span> <span class="no">Load</span> <span class="p">(</span><span class="mf">0.2</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">"comments"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"comments"</span> <span class="no">WHERE</span> <span class="s2">"comments"</span><span class="o">.</span><span class="s2">"post_id"</span> <span class="no">IN</span> <span class="p">(</span><span class="sc">?,</span> <span class="p">?)</span>  <span class="p">[[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">"post_id"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>

<span class="c1"># first iteration</span>
<span class="n">posts</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">p</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">size</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></table></code></div></div><p>No additional ActiveRecord query fired. Size also have benifit if you are using <code class="language-plaintext highlighter-rouge">counter cache</code></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tips/'>Tips</a>, <a href='/categories/rubyonrails/'>RubyOnRails</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ruby-on-rails/" class="post-tag no-text-decoration" >ruby on rails</a> <a href="/tags/performance/" class="post-tag no-text-decoration" >performance</a> <a href="/tags/count/" class="post-tag no-text-decoration" >count</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Rails count vs size vs length - Pushpa Raj Badu&url=https://przbadu.github.io/posts/rails-count-vs-size-vs-length/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Rails count vs size vs length - Pushpa Raj Badu&u=https://przbadu.github.io/posts/rails-count-vs-size-vs-length/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://przbadu.github.io/posts/rails-count-vs-size-vs-length/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/elasticsearch-and-kibana-setup-with-docker/">ElasticSearch and Kibana setup with docker</a><li><a href="/posts/my-vim-configuration/">my neovim configuration</a><li><a href="/posts/my-tmux-configuration-and-workflow/">My tmux configuration and workflow</a><li><a href="/posts/rails-notes-explained/">Rails Notes Explained</a><li><a href="/posts/filter-empty-element-from-an-array/">filter empty element from an array</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ruby-on-rails/">ruby on rails</a> <a class="post-tag" href="/tags/hash/">hash</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/count/">count</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/devise/">devise</a> <a class="post-tag" href="/tags/docker-compose/">docker-compose</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/elastic-search/">Elastic search</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ruby-safe-navigation-operator/"><div class="card-body"> <em class="timeago small" date="2022-01-09 16:30:00 +0545" >Jan 9</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ruby safe navigation operator (&.)</h3><div class="text-muted small"><p> This post you will learn about the most interesting addition to Ruby 2.3.0, the Safe Navigation Operator(&amp;amp;.). Scenario Lets say we have a cart object, which belongs to an owner and we want to...</p></div></div></a></div><div class="card"> <a href="/posts/change-rails-database-from-sqlite-to-postgresql/"><div class="card-body"> <em class="timeago small" date="2022-01-28 10:43:00 +0545" >Jan 28</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>change rails database from sqlite to postgresql</h3><div class="text-muted small"><p> When you generate your rails applicaton, it by default uses sqlite3 as database adapter and generate configuration files config/database.yml based on sqlite adapter. But when you want to deploy you...</p></div></div></a></div><div class="card"> <a href="/posts/devise-sign-out-issue-with-rails-7/"><div class="card-body"> <em class="timeago small" date="2022-02-10 08:35:00 +0545" >Feb 10</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Devise sign out issue with rails 7</h3><div class="text-muted small"><p> After creating my first rails 7 project, I added devise gem for authentication solution, and there were couple of issues I faced because of rails 7 changes mainly with turbo streams. One of those ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/use-timecop-to-time-travel-in-testing/" class="btn btn-outline-primary" prompt="Older"><p>Use Timecop to time travel in testing</p></a> <a href="/posts/change-rails-database-from-sqlite-to-postgresql/" class="btn btn-outline-primary" prompt="Newer"><p>change rails database from sqlite to postgresql</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/przbadu">Pushpa Raj Badu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ruby-on-rails/">ruby on rails</a> <a class="post-tag" href="/tags/hash/">hash</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/count/">count</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/devise/">devise</a> <a class="post-tag" href="/tags/docker-compose/">docker-compose</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/elastic-search/">Elastic search</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-H72HW07T2Y"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-H72HW07T2Y'); }); </script>
